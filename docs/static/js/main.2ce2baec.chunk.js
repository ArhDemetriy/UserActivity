(this["webpackJsonpreact-template"]=this["webpackJsonpreact-template"]||[]).push([[0],{41:function(t,e,n){},42:function(t,e,n){},43:function(t,e,n){},44:function(t,e,n){},54:function(t,e,n){},55:function(t,e,n){},56:function(t,e,n){},57:function(t,e,n){},58:function(t,e,n){},59:function(t,e,n){"use strict";n.r(e);var a=n(6),i=n.n(a),r=n(26),c=n.n(r),s=(n(41),n(42),n(12)),o=(n(43),n(44),n(1)),u=n.n(o),l=n(3),d=n(0),v=n(2),f=n(20),h=n(33),b=Object(h.a)({apiKey:"AIzaSyAy2GjQAfutCFa3toa9WLDFTkMehtj_CNk",authDomain:"useractivity-4c085.firebaseapp.com",projectId:"useractivity-4c085",storageBucket:"useractivity-4c085.appspot.com",messagingSenderId:"1007647890248",appId:"1:1007647890248:web:91e91fec7ca033ae29b17d"}),j=Object(f.getFirestore)(b),p=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"getCollection",value:function(t){return this.collections.has(t)||this.collections.set(t,f.collection(this.selfFirestore,t)),this.collections.get(t)}},{key:"add",value:function(t,e){return f.addDoc(this.getCollection(t),e)}},{key:"getFirestoreDocs",value:function(t){return f.getDocs(f.collectionGroup(this.selfFirestore,this.getCollection(t).id))}},{key:"deleteCollection",value:function(t){return this.getFirestoreDocs(t).then((function(t){return t.docs.map((function(t){return t.ref}))})).then((function(t){return t.forEach((function(t){return f.deleteDoc(t)}))}))}},{key:"getDocs",value:function(t){return this.getFirestoreDocs(t).then((function(t){return t.docs.map((function(t){return t.data()}))}))}}]),t}();p.selfFirestore=j,p.firestore=f,p.collections=new Map;var g="users",y=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"load",value:function(){return p.getDocs(g).then((function(t){return t.sort((function(t,e){return t.id-e.id}))}))}},{key:"saveAll",value:function(t){return p.deleteCollection(g).then((function(){return Promise.all(t.map((function(t){return p.add(g,t)})))}))}}]),t}(),m=n(11),O=n(35),x="REPLACE_HISTOGRAM",k="REPLACE_SPLINE",A="SET_RETENTION";function N(t,e){return e.type===x&&e.payload.histogram?Object(m.a)(Object(m.a)({},t),{},{histogram:Object(m.a)(Object(m.a)({},t.histogram),e.payload.histogram)}):e.type===k&&e.payload.spline?Object(m.a)(Object(m.a)({},t),{},{spline:e.payload.spline}):e.type===A&&void 0!==e.payload.retention?Object(m.a)(Object(m.a)({},t),{},{retention:+e.payload.retention}):t}var D=n(15),T="ADD_USERS",S="REPLACE_USERS";function w(t,e){return e.type===T?t.concat(e.payload.users):e.type===S?Object(D.a)(e.payload.users):t}var C={users:[],graph:{retention:NaN,histogram:{bins:[],maxBin:NaN},spline:[]}},F=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,e=arguments.length>1?arguments[1]:void 0;return Object(m.a)(Object(m.a)({},t),{},{users:w(t.users,e),graph:N(t.graph,e)})},I=Object(O.a)(F),R=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"addUsers",value:function(t){I.dispatch({type:T,payload:{users:t}})}},{key:"updateUser",value:function(t,e){var n=I.getState().users,a=e;!Number.isFinite(e)||e<0?a=0:e>n.length-1&&(a=n.length-1);var i=n[a];n[a]=Object(m.a)(Object(m.a)({},i),t),I.dispatch({type:S,payload:{users:n}})}},{key:"replaceUsers",value:function(t){I.dispatch({type:S,payload:{users:t}})}}]),t}();function L(t,e){return{data:t,status:e}}function E(){return I.getState().users}var U=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"validate",value:function(){return this.validateAllIds()}},{key:"validateAllIds",value:function(){var t,e=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=E(),i={},r=!0;a.forEach((function(t,e){var n;if("loading"!==t.id.status){var a=t.id.data;(null===(n=i[a])||void 0===n?void 0:n.length)?(i[a].push(e),r=!1):i[a]=[e]}}));var c=new Set((t=[]).concat.apply(t,Object(D.a)(Object.values(i).filter((function(t){return t.length>1}))))),s=!1,o=a.map((function(t){if(!n&&"valid"===t.id.status)return t;if("loading"===t.id.status)return t;var a=!c.has(t.id.data);return e.updateValidStatusIn(t,{id:{status:a?"valid":"invalid"}})?(s=!0,Object(m.a)({},t)):t}));return s&&R.replaceUsers(o),r}},{key:"validateUserId",value:function(t){var e=E(),n=e[t];if(!(null===n||void 0===n?void 0:n.id))return!1;var a=n.id.data,i=!0;return i=!!Number.isFinite(a)&&e.every((function(e,n){return a!==e.id.data||t===n})),this.updateValidStatusIn(n,{id:{status:i?"valid":"invalid"}})&&R.updateUser(n,t),i}},{key:"validateAllDate",value:function(){var t=this,e=!0;return E().forEach((function(n,a){e=t.validateUserDate(a)&&e})),e}},{key:"validateUserDate",value:function(t){var e,n,a=E()[t];if(!(null===a||void 0===a?void 0:a.registration)||!(null===a||void 0===a?void 0:a.lastActivity))return!1;var i=(null===(e=a.lastActivity.data)||void 0===e?void 0:e.getTime)&&a.lastActivity.data.getTime(),r=(null===(n=a.registration.data)||void 0===n?void 0:n.getTime)&&a.registration.data.getTime(),c=Date.now(),s=i<c,o=!0;return o=s?r<=i:r<c,this.updateValidStatusIn(a,{lastActivity:{status:s?"valid":"invalid"},registration:{status:o?"valid":"invalid"}})&&R.updateUser(a,t),s&&o}},{key:"updateValidStatusIn",value:function(t,e){for(var n=!1,a=0,i=Object.keys(e);a<i.length;a++){var r=i[a];t[r].status!==e[r].status&&(t[r].status=e[r].status,n=!0)}return n}}]),t}(),_=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"init",value:function(){return this.safetyLoad()}},{key:"validate",value:function(){return U.validate()}},{key:"trySave",value:function(){var t=Object(l.a)(u.a.mark((function t(){var e;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.validate()){t.next=2;break}throw new Error("invalid users data");case 2:return n=E(),e=n.map((function(t){return{id:t.id.data,registration:t.registration.data.getTime(),lastActivity:t.lastActivity.data.getTime()}})),t.abrupt("return",y.saveAll(e));case 4:case"end":return t.stop()}var n}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"tryLoad",value:function(){var t=this;return this.separatePromise((function(){return y.load()})).then((function(e){return t.separatePromise((function(){return function(t){return t.map((function(t){return{id:L(t.id,"valid"),registration:L(new Date(t.registration),"valid"),lastActivity:L(new Date(t.lastActivity),"valid")}}))}(e)}))})).then((function(e){return t.separatePromise((function(){return R.replaceUsers(e)}))}))}},{key:"safetyLoad",value:function(){return this.tryLoad().catch((function(t){return console.error(t)}))}},{key:"separatePromise",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise((function(n){setTimeout((function(){n(t())}),e)}))}}]),t}();function M(){var t=E();if(Array.isArray(t)&&t.length){var e=t[t.length-1].id.data,n=P();n.id.data=e+1,R.addUsers([n])}else R.addUsers([P()])}function P(){return{id:L(1,"needValidate"),registration:L(new Date,"needValidate"),lastActivity:L(new Date,"needValidate")}}var B=n(4),V=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"setRetention",value:function(t){I.dispatch({type:A,payload:{retention:t}})}},{key:"replaceHistogram",value:function(t){I.dispatch({type:x,payload:{histogram:t}})}},{key:"pushHistogramBins",value:function(t){var e=I.getState().graph.histogram,n=e.bins.concat(t);I.dispatch({type:x,payload:{histogram:Object(m.a)(Object(m.a)({},e),{},{bins:n})}})}},{key:"replaceSpline",value:function(t){I.dispatch({type:k,payload:{spline:t}})}}]),t}(),Y=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"calcHistogram",value:function(){var t=this.getBinLifeTimes(),e=Math.max.apply(Math,Object(D.a)(t)),n=this.normTo1(t,e);V.replaceHistogram({bins:n,maxBin:e})}},{key:"getBinLifeTimes",value:function(){var t,e=this.getLifeTimes(),n=new Array(e.length).fill(0),a=0,i=Object(B.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value,c=Math.floor(r/this.DAY);n[c]+=1,c>a&&(a=c)}}catch(s){i.e(s)}finally{i.f()}return n.slice(0,a+1)}},{key:"getLifeTimes",value:function(){return E().map((function(t){return t.lastActivity.data.getTime()-t.registration.data.getTime()}))}},{key:"normTo1",value:function(t,e){var n=e||Math.max.apply(Math,Object(D.a)(t));return n?t.map((function(t){return t/n})):t}},{key:"getDebugBins",value:function(t,e){for(var n=[],a=0;a<t;a++)n.push(Math.round(Math.random()*e));return n}}]),t}();Y.DAY=864e5;var H=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"calcRetention",value:function(){var t=this.getRollingRetention(7);Number.isFinite(t)&&V.setRetention(t)}},{key:"getRollingRetention",value:function(t){if(t<1)return 1;var e,n=this.floorTime(this.getIntervalTime(t)),a=this.floorTime(Date.now()),i=0,r=0,c=E(),s=Object(B.a)(c);try{for(s.s();!(e=s.n()).done;){var o=e.value,u=this.floorTime(o.registration.data.getTime());a-u>=n&&r++,this.floorTime(o.lastActivity.data.getTime())-u>=n&&i++}}catch(l){s.e(l)}finally{s.f()}return r?i/r:NaN}},{key:"getIntervalTime",value:function(t){return t*this.DAY}},{key:"floorTime",value:function(t){return t-t%this.DAY}},{key:"getSimpleRollingRetention",value:function(t){if(t<1)return NaN;var e,n=this.getIntervalTime(t),a=E(),i=0,r=0,c=Date.now(),s=Object(B.a)(a);try{for(s.s();!(e=s.n()).done;){var o=e.value,u=o.registration.data.getTime();c-u<=n?r++:o.lastActivity.data.getTime()-u>=n&&i++}}catch(l){s.e(l)}finally{s.f()}return r?i/r:NaN}}]),t}();function z(){H.calcRetention(),Y.calcHistogram()}H.DAY=864e5;var G=n(13),q=n(5),J=function(){var t=Object(G.b)((function(t){var e;return(null===(e=t.users)||void 0===e?void 0:e.length)>0})),e=Object(a.useState)(!1),n=Object(s.a)(e,2),i=n[0],r=n[1];return Object(q.jsxs)("div",{className:"controls",children:[Object(q.jsx)("button",{className:"controls-button_add button",type:"button",onClick:M,children:"Add"}),Object(q.jsx)("button",{className:"controls-button_save button",disabled:!t,type:"submit",onClick:function(t){var e;i||(r(!0),e=function(){return r(!1)},_.trySave().then((function(){return _.tryLoad()})).catch((function(t){return console.error(t)})).finally(e))},children:"Save"}),Object(q.jsx)("button",{className:"controls-button_calculate button",disabled:!t,type:"button",onClick:z,children:"Calculate"})]})},K=(n(54),n(55),function(t){var e=t.height,n=void 0===e?500:e,a=Object(G.b)((function(t){return t.graph.histogram.maxBin||0})),i=Object(G.b)((function(t){return t.graph.histogram.bins}));if(!Array.isArray(i))return Object(q.jsx)("svg",{});var r=n,c=50,s=r-100,o=13*i.length+100;function u(t){return Object(q.jsx)("text",{x:"".concat(13*t+c+5),y:"".concat(r-25),textAnchor:"middle",children:"".concat(t)})}return Object(q.jsx)("svg",{width:"".concat(o),height:"".concat(r),textRendering:"optimizeLegibility",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:Object(q.jsxs)("g",{fill:"#4A9DFF",children:[function(){var t=25,e=a/2,n=r-c-s,i=r-c-s/2,u=r-c;return Object(q.jsxs)("g",{stroke:"rgba(74, 157, 255, .4)",children:[Object(q.jsx)("text",{x:"".concat(t),textAnchor:"middle",y:"".concat(n),children:"".concat(a)}),Object(q.jsx)("line",{x1:"".concat(t),x2:"".concat(o-c),y1:"".concat(n," "),y2:"".concat(n)}),Object(q.jsx)("text",{x:"".concat(t),textAnchor:"middle",y:"".concat(i),children:"".concat(e)}),Object(q.jsx)("line",{x1:"".concat(t),x2:"".concat(o-c),y1:"".concat(i," "),y2:"".concat(i)}),Object(q.jsx)("text",{x:"".concat(t),textAnchor:"middle",y:"".concat(u),children:"0"}),Object(q.jsx)("line",{x1:"".concat(t),x2:"".concat(o-c),y1:"".concat(u," "),y2:"".concat(u)})]})}(),i.map((function(t,e){var n=t*s;return Object(q.jsxs)("g",{children:[Object(q.jsx)("rect",{x:"".concat(13*e+c),y:"".concat(r-n-c),width:"".concat(10),height:"".concat(n)}),!(e%5)&&u(e)]},e)}))]})})}),Q=function(){var t=Object(G.b)((function(t){var e;return!!(null===(e=t.graph.histogram.bins)||void 0===e?void 0:e.length)}));return Object(q.jsx)("div",{className:"histogram",children:t&&Object(q.jsx)(K,{})})},W=(n(56),function(){var t=Object(G.b)((function(t){return t.graph.retention}));return Number.isFinite(t)?Object(q.jsx)("div",{className:"retention",children:"Rolling Retention 7 day: ".concat(t)}):Object(q.jsx)("div",{})}),X=function(){return Object(q.jsxs)("div",{className:"graph",children:[Object(q.jsx)(W,{}),Object(q.jsx)(Q,{})]})};n(57),n(58);function Z(t){return(null===t||void 0===t?void 0:t.getFullYear)?"".concat(t.getFullYear(),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getDate().toString().padStart(2,"0")):""}function $(t){if(!(null===t||void 0===t?void 0:t.split))return new Date;var e=t.trim().split("-").map((function(t){return parseInt(t)||0})),n=new Date;return e.length&&n.setFullYear(e[0],e[1],e[2]),n}function tt(t,e){var n=E()[e];n&&R.updateUser(Object(m.a)(Object(m.a)({},n),t),e)}var et=function(t){var e=t.index,n=t.requireCssClass,a=Object(G.b)((function(t){var n;return null===(n=t.users[e])||void 0===n?void 0:n.id.data})),i=Object(G.b)((function(t){var n;return"valid"===(null===(n=t.users[e])||void 0===n?void 0:n.id.status)})),r=Object(G.b)((function(t){var n;return Z(null===(n=t.users[e])||void 0===n?void 0:n.lastActivity.data)})),c=Object(G.b)((function(t){var n;return"valid"===(null===(n=t.users[e])||void 0===n?void 0:n.lastActivity.status)})),s=Object(G.b)((function(t){var n;return Z(null===(n=t.users[e])||void 0===n?void 0:n.registration.data)})),o=Object(G.b)((function(t){var n;return"valid"===(null===(n=t.users[e])||void 0===n?void 0:n.registration.status)}));if(!a&&0!==a)return Object(q.jsx)("div",{});var u=n+" user";return Object(q.jsxs)("tr",{className:u,children:[Object(q.jsx)("td",{className:"user-item user-item_first",children:Object(q.jsx)("input",{value:a,name:"userId",onChange:function(t){tt({id:L(+t.target.value,"needValidate")},e)},type:"number",className:"user-item-input user-item-input_clear"+(i?"":" user-item-input_invalid"),size:a.toString().length+1})}),Object(q.jsx)("td",{className:"user-item",children:Object(q.jsx)("input",{value:s,name:"registration",onChange:function(t){tt({registration:L($(t.target.value),"needValidate")},e)},type:"date",className:"user-item-input"+(o?"":" user-item-input_invalid")})}),Object(q.jsx)("td",{className:"user-item user-item_last",children:Object(q.jsx)("input",{value:r,name:"lastActivity",onChange:function(t){tt({lastActivity:L($(t.target.value),"needValidate")},e)},type:"date",className:"user-item-input"+(c?"":" user-item-input_invalid")})})]})},nt=function(){var t=Object(G.b)((function(t){return t.users}),(function(t,e){return t.length===e.length}));return Object(q.jsxs)("table",{className:"table",children:[Object(q.jsx)("caption",{className:"table-caption",children:"Users activity"}),Object(q.jsx)("thead",{className:"table-head",children:Object(q.jsxs)("tr",{children:[Object(q.jsx)("th",{className:"table-head-item",scope:"col",children:"UserID"}),Object(q.jsx)("th",{className:"table-head-item",scope:"col",children:"Date Registration"}),Object(q.jsx)("th",{className:"table-head-item",scope:"col",children:"Date Last Activity"})]})}),Object(q.jsx)("tbody",{className:"table-body",children:t.map((function(t,e){return Object(q.jsx)(et,{requireCssClass:"table-body-item",index:e},"table-".concat(e,"-").concat(t.id))}))})]})},at=function(){return Object(q.jsxs)("div",{className:"app",children:[Object(q.jsx)(J,{}),Object(q.jsxs)("div",{className:"app-data",children:[Object(q.jsx)("div",{className:"app-data-table",children:Object(q.jsx)(nt,{})}),Object(q.jsx)(X,{})]})]})},it=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,60)).then((function(e){var n=e.getCLS,a=e.getFID,i=e.getFCP,r=e.getLCP,c=e.getTTFB;n(t),a(t),i(t),r(t),c(t)}))};_.init(),c.a.render(Object(q.jsxs)(i.a.StrictMode,{children:[Object(q.jsx)(G.a,{store:I,children:Object(q.jsx)(at,{})}),","]}),document.getElementById("root")),it()}},[[59,1,2]]]);
//# sourceMappingURL=main.2ce2baec.chunk.js.map