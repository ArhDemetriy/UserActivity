(this["webpackJsonpreact-template"]=this["webpackJsonpreact-template"]||[]).push([[0],{41:function(t,e,n){},42:function(t,e,n){},43:function(t,e,n){},44:function(t,e,n){},48:function(t,e,n){},49:function(t,e,n){},56:function(t,e,n){},57:function(t,e,n){},58:function(t,e,n){},59:function(t,e,n){"use strict";n.r(e);var a=n(6),c=n.n(a),i=n(26),r=n.n(i),o=(n(41),n(42),n(11)),s=(n(43),n(44),n(0)),u=n.n(s),l=n(3),h=n(1),b=n(2),d=n(20),j=n(33),f=Object(j.a)({apiKey:"AIzaSyAy2GjQAfutCFa3toa9WLDFTkMehtj_CNk",authDomain:"useractivity-4c085.firebaseapp.com",projectId:"useractivity-4c085",storageBucket:"useractivity-4c085.appspot.com",messagingSenderId:"1007647890248",appId:"1:1007647890248:web:91e91fec7ca033ae29b17d"}),g=Object(d.getFirestore)(f),p=function(){function t(){Object(h.a)(this,t)}return Object(b.a)(t,null,[{key:"getCollection",value:function(t){return this.collections.has(t)||this.collections.set(t,d.collection(this.selfFirestore,t)),this.collections.get(t)}},{key:"add",value:function(t,e){return d.addDoc(this.getCollection(t),e)}},{key:"getFirestoreDocs",value:function(t){return d.getDocs(d.collectionGroup(this.selfFirestore,this.getCollection(t).id))}},{key:"deleteCollection",value:function(t){return this.getFirestoreDocs(t).then((function(t){return t.docs.map((function(t){return t.ref}))})).then((function(t){return t.forEach((function(t){return d.deleteDoc(t)}))}))}},{key:"getDocs",value:function(t){return this.getFirestoreDocs(t).then((function(t){return t.docs.map((function(t){return t.data()}))}))}}]),t}();p.selfFirestore=g,p.firestore=d,p.collections=new Map;var v="users",y=function(){function t(){Object(h.a)(this,t)}return Object(b.a)(t,null,[{key:"load",value:function(){return p.getDocs(v).then((function(t){return t.sort((function(t,e){return t.id-e.id}))}))}},{key:"saveAll",value:function(t){return p.deleteCollection(v).then((function(){return Promise.all(t.map((function(t){return p.add(v,t)})))}))}}]),t}(),m=n(35),O=n(12),x="REPLACE_HISTOGRAM",k="REPLACE_SPLINE",N="SET_RETENTION";function A(t,e){return e.type===x&&e.payload.histogram?Object(O.a)(Object(O.a)({},t),{},{histogram:Object(O.a)(Object(O.a)({},t.histogram),e.payload.histogram)}):e.type===k&&e.payload.spline?Object(O.a)(Object(O.a)({},t),{},{spline:e.payload.spline}):e.type===N&&void 0!==e.payload.retention?Object(O.a)(Object(O.a)({},t),{},{retention:+e.payload.retention}):t}var D=n(15),T="ADD_USERS",S="REPLACE_USERS";function C(t,e){return e.type===T?t.concat(e.payload.users):e.type===S?Object(D.a)(e.payload.users):t}var w={users:[],graph:{retention:NaN,histogram:{bins:[],maxBin:NaN},spline:[]}},R=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,e=arguments.length>1?arguments[1]:void 0;return Object(O.a)(Object(O.a)({},t),{},{users:C(t.users,e),graph:A(t.graph,e)})},F=Object(m.a)(R),L=function(){function t(){Object(h.a)(this,t)}return Object(b.a)(t,null,[{key:"addUsers",value:function(t){F.dispatch({type:T,payload:{users:t}})}},{key:"replaceUsers",value:function(t){F.dispatch({type:S,payload:{users:t}})}}]),t}();function E(){return F.getState().users}var I=function(){function t(){Object(h.a)(this,t)}return Object(b.a)(t,null,[{key:"init",value:function(){return this.safetyLoad()}},{key:"validate",value:function(){return!0}},{key:"trySave",value:function(){var t=Object(l.a)(u.a.mark((function t(){var e;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.validate()){t.next=2;break}throw new Error("invalid users data");case 2:return n=E(),e=n.map((function(t){return Object(O.a)(Object(O.a)({},t),{},{registration:t.registration.getTime(),lastActivity:t.lastActivity.getTime()})})),t.abrupt("return",y.saveAll(e));case 4:case"end":return t.stop()}var n}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"tryLoad",value:function(){return y.load().then((function(t){return function(t){return t.map((function(t){return Object(O.a)(Object(O.a)({},t),{},{registration:new Date(t.registration),lastActivity:new Date(t.lastActivity)})}))}(t)})).then((function(t){return L.replaceUsers(t)}))}},{key:"safetyLoad",value:function(){return this.tryLoad().catch((function(t){return console.error(t)}))}}]),t}();var M=function(t){var e=E();if(Array.isArray(e)&&e.length){var n=e[e.length-1];L.addUsers([Object(O.a)(Object(O.a)({},_()),{},{id:n.id+1})])}else L.addUsers([_()])};function _(){return{id:1,registration:new Date,lastActivity:new Date}}var B=n(4),U=function(){function t(){Object(h.a)(this,t)}return Object(b.a)(t,null,[{key:"setRetention",value:function(t){F.dispatch({type:N,payload:{retention:t}})}},{key:"replaceHistogram",value:function(t){F.dispatch({type:x,payload:{histogram:t}})}},{key:"pushHistogramBins",value:function(t){var e=F.getState().graph.histogram,n=e.bins.concat(t);F.dispatch({type:x,payload:{histogram:Object(O.a)(Object(O.a)({},e),{},{bins:n})}})}},{key:"replaceSpline",value:function(t){F.dispatch({type:k,payload:{spline:t}})}}]),t}(),P=function(){function t(){Object(h.a)(this,t)}return Object(b.a)(t,null,[{key:"calcHistogram",value:function(){var t=this.getBinLifeTimes(),e=Math.max.apply(Math,Object(D.a)(t)),n=this.normTo1(t,e);U.replaceHistogram({bins:n,maxBin:e})}},{key:"getBinLifeTimes",value:function(){var t,e=this.getDebugBins(300,51*this.DAY),n=new Array(e.length).fill(0),a=0,c=Object(B.a)(e);try{for(c.s();!(t=c.n()).done;){var i=t.value,r=Math.floor(i/this.DAY);n[r]+=1,r>a&&(a=r)}}catch(o){c.e(o)}finally{c.f()}return n.slice(0,a+1)}},{key:"getLifeTimes",value:function(){return E().map((function(t){return t.lastActivity.getTime()-t.registration.getTime()}))}},{key:"normTo1",value:function(t,e){var n=e||Math.max.apply(Math,Object(D.a)(t));return n?t.map((function(t){return t/n})):t}},{key:"getDebugBins",value:function(t,e){for(var n=[],a=0;a<t;a++)n.push(Math.round(Math.random()*e));return n}}]),t}();P.DAY=864e5;var Y=function(){function t(){Object(h.a)(this,t)}return Object(b.a)(t,null,[{key:"calcRetention",value:function(){var t=this.getRollingRetention(7);Number.isFinite(t)&&U.setRetention(t)}},{key:"getRollingRetention",value:function(t){if(t<1)return 1;var e,n=this.floorTime(this.getIntervalTime(t)),a=this.floorTime(Date.now()),c=0,i=0,r=E(),o=Object(B.a)(r);try{for(o.s();!(e=o.n()).done;){var s=e.value,u=this.floorTime(s.registration.getTime());a-u>=n&&i++,this.floorTime(s.lastActivity.getTime())-u>=n&&c++}}catch(l){o.e(l)}finally{o.f()}return i?c/i:NaN}},{key:"getIntervalTime",value:function(t){return t*this.DAY}},{key:"floorTime",value:function(t){return t-t%this.DAY}},{key:"getSimpleRollingRetention",value:function(t){if(t<1)return NaN;var e,n=this.getIntervalTime(t),a=E(),c=0,i=0,r=Date.now(),o=Object(B.a)(a);try{for(o.s();!(e=o.n()).done;){var s=e.value,u=s.registration.getTime();r-u<=n?i++:s.lastActivity.getTime()-u>=n&&c++}}catch(l){o.e(l)}finally{o.f()}return i?c/i:NaN}}]),t}();Y.DAY=864e5;var H=function(t){Y.calcRetention(),P.calcHistogram()},z=n(5),G=function(){var t=Object(a.useState)(!1),e=Object(o.a)(t,2),n=e[0],c=e[1];return Object(z.jsxs)("div",{className:"controls",children:[Object(z.jsx)("button",{className:"controls-button_add button",disabled:n,type:"button",onClick:M,children:"Add"}),Object(z.jsx)("button",{className:"controls-button_save button",disabled:n,type:"submit",onClick:function(t){c(!0),I.trySave().then((function(){return I.tryLoad()})).catch((function(t){return console.error(t)})).finally((function(){return c(!1)}))},children:"Save"}),Object(z.jsx)("button",{className:"controls-button_calculate button",disabled:n,type:"button",onClick:H,children:"Calculate"})]})},q=(n(48),n(49),n(18)),J=function(t){var e=t.height,n=void 0===e?500:e,a=Object(q.b)((function(t){return t.graph.histogram.maxBin||0})),c=Object(q.b)((function(t){return t.graph.histogram.bins}));if(!Array.isArray(c))return Object(z.jsx)("svg",{});var i=n,r=50,o=i-100,s=13*c.length+100;function u(t){return Object(z.jsx)("text",{x:"".concat(13*t+r+5),y:"".concat(i-25),textAnchor:"middle",children:"".concat(t)})}return Object(z.jsx)("svg",{width:"".concat(s),height:"".concat(i),"text-rendering":"optimizeLegibility",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:Object(z.jsxs)("g",{fill:"#4A9DFF",children:[function(){var t=25,e=a/2,n=i-r-o,c=i-r-o/2,u=i-r;return Object(z.jsxs)("g",{stroke:"rgba(74, 157, 255, .4)",children:[Object(z.jsx)("text",{x:"".concat(t),textAnchor:"middle",y:"".concat(n),children:"".concat(a)}),Object(z.jsx)("line",{x1:"".concat(t),x2:"".concat(s-r),y1:"".concat(n," "),y2:"".concat(n)}),Object(z.jsx)("text",{x:"".concat(t),textAnchor:"middle",y:"".concat(c),children:"".concat(e)}),Object(z.jsx)("line",{x1:"".concat(t),x2:"".concat(s-r),y1:"".concat(c," "),y2:"".concat(c)}),Object(z.jsx)("text",{x:"".concat(t),textAnchor:"middle",y:"".concat(u),children:"0"}),Object(z.jsx)("line",{x1:"".concat(t),x2:"".concat(s-r),y1:"".concat(u," "),y2:"".concat(u)})]})}(),c.map((function(t,e){var n=t*o;return Object(z.jsxs)("g",{children:[Object(z.jsx)("rect",{x:"".concat(13*e+r),y:"".concat(i-n-r),width:"".concat(10),height:"".concat(n)},e),e%5||u(e)]})}))]})})},K=function(){return Object(z.jsx)("div",{className:"histogram",children:Object(z.jsx)(J,{})})},Q=(n(56),function(){var t=Object(q.b)((function(t){return t.graph.retention}));return Number.isFinite(t)?Object(z.jsx)("div",{className:"retention",children:"Rolling Retention 7 day: ".concat(t)}):Object(z.jsx)("div",{})}),W=function(){return Object(z.jsxs)("div",{className:"graph",children:[Object(z.jsx)(Q,{}),Object(z.jsx)(K,{})]})};n(57),n(58);function V(t){return"".concat(t.getFullYear(),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getDate().toString().padStart(2,"0"))}var X=function(t){var e=t.index,n=t.requireCssClass,c=Object(q.b)((function(t){return t.users[e]})),i=Object(a.useState)(c.id),r=Object(o.a)(i,2),s=r[0],u=r[1],l=Object(a.useState)(V(c.registration)),h=Object(o.a)(l,2),b=h[0],d=h[1],j=Object(a.useState)(V(c.lastActivity)),f=Object(o.a)(j,2),g=f[0],p=f[1];return c?Object(z.jsxs)("tr",{className:n+" user",children:[Object(z.jsx)("td",{className:"user-item user-item_first",children:Object(z.jsx)("input",{value:s,name:"userId",onChange:function(t){return u(+t.target.value)},type:"number",className:"user-item-input user-item-input_clear",size:s.toString().length+1})}),Object(z.jsx)("td",{className:"user-item",children:Object(z.jsx)("input",{value:b,name:"registration",onChange:function(t){return d(t.target.value)},type:"date",className:"user-item-input"})}),Object(z.jsx)("td",{className:"user-item user-item_last",children:Object(z.jsx)("input",{value:g,name:"lastActivity",onChange:function(t){return p(t.target.value)},type:"date",className:"user-item-input"})})]}):null},Z=function(){var t=Object(q.b)((function(t){return t.users}),(function(t,e){return t.length===e.length}));return Object(z.jsxs)("table",{className:"table",children:[Object(z.jsx)("caption",{className:"table-caption",children:"Users activity"}),Object(z.jsx)("thead",{className:"table-head",children:Object(z.jsxs)("tr",{children:[Object(z.jsx)("th",{className:"table-head-item",scope:"col",children:"UserID"}),Object(z.jsx)("th",{className:"table-head-item",scope:"col",children:"Date Registration"}),Object(z.jsx)("th",{className:"table-head-item",scope:"col",children:"Date Last Activity"})]})}),Object(z.jsx)("tbody",{className:"table-body",children:t.map((function(t,e){return Object(z.jsx)(X,{requireCssClass:"table-body-item",index:e},"table-".concat(e,"-").concat(t.id))}))})]})},$=function(){return Object(z.jsxs)("div",{className:"app",children:[Object(z.jsxs)("div",{className:"app-data",children:[Object(z.jsx)(Z,{}),Object(z.jsx)(W,{})]}),Object(z.jsx)(G,{})]})},tt=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,60)).then((function(e){var n=e.getCLS,a=e.getFID,c=e.getFCP,i=e.getLCP,r=e.getTTFB;n(t),a(t),c(t),i(t),r(t)}))};I.init(),r.a.render(Object(z.jsxs)(c.a.StrictMode,{children:[Object(z.jsx)(q.a,{store:F,children:Object(z.jsx)($,{})}),","]}),document.getElementById("root")),tt()}},[[59,1,2]]]);
//# sourceMappingURL=main.263ceb85.chunk.js.map