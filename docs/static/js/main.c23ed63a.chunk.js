(this["webpackJsonpreact-template"]=this["webpackJsonpreact-template"]||[]).push([[0],{41:function(t,e,n){},42:function(t,e,n){},43:function(t,e,n){},44:function(t,e,n){},48:function(t,e,n){},55:function(t,e,n){},56:function(t,e,n){},57:function(t,e,n){},58:function(t,e,n){},59:function(t,e,n){"use strict";n.r(e);var i=n(6),a=n.n(i),r=n(26),c=n.n(r),o=(n(41),n(42),n(12)),s=(n(43),n(44),n(1)),u=n.n(s),l=n(3),d=n(0),v=n(2),f=n(20),h=n(33),b=Object(h.a)({apiKey:"AIzaSyAy2GjQAfutCFa3toa9WLDFTkMehtj_CNk",authDomain:"useractivity-4c085.firebaseapp.com",projectId:"useractivity-4c085",storageBucket:"useractivity-4c085.appspot.com",messagingSenderId:"1007647890248",appId:"1:1007647890248:web:91e91fec7ca033ae29b17d"}),j=Object(f.getFirestore)(b),p=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"getCollection",value:function(t){return this.collections.has(t)||this.collections.set(t,f.collection(this.selfFirestore,t)),this.collections.get(t)}},{key:"add",value:function(t,e){return f.addDoc(this.getCollection(t),e)}},{key:"getFirestoreDocs",value:function(t){return f.getDocs(f.collectionGroup(this.selfFirestore,this.getCollection(t).id))}},{key:"deleteCollection",value:function(t){return this.getFirestoreDocs(t).then((function(t){return t.docs.map((function(t){return t.ref}))})).then((function(t){return t.forEach((function(t){return f.deleteDoc(t)}))}))}},{key:"getDocs",value:function(t){return this.getFirestoreDocs(t).then((function(t){return t.docs.map((function(t){return t.data()}))}))}}]),t}();p.selfFirestore=j,p.firestore=f,p.collections=new Map;var g="users",y=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"load",value:function(){return p.getDocs(g).then((function(t){return t.sort((function(t,e){return t.id-e.id}))}))}},{key:"saveAll",value:function(t){return p.deleteCollection(g).then((function(){return Promise.all(t.map((function(t){return p.add(g,t)})))}))}}]),t}(),m=n(11),O=n(35),x="REPLACE_HISTOGRAM",k="REPLACE_SPLINE",A="SET_RETENTION";function N(t,e){return e.type===x&&e.payload.histogram?Object(m.a)(Object(m.a)({},t),{},{histogram:Object(m.a)(Object(m.a)({},t.histogram),e.payload.histogram)}):e.type===k&&e.payload.spline?Object(m.a)(Object(m.a)({},t),{},{spline:e.payload.spline}):e.type===A&&void 0!==e.payload.retention?Object(m.a)(Object(m.a)({},t),{},{retention:+e.payload.retention}):t}var D=n(16),T="ADD_USERS",S="REPLACE_USERS";function w(t,e){return e.type===T?t.concat(e.payload.users):e.type===S?Object(D.a)(e.payload.users):t}var C={users:[],graph:{retention:NaN,histogram:{bins:[],maxBin:NaN},spline:[]}},F=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,e=arguments.length>1?arguments[1]:void 0;return Object(m.a)(Object(m.a)({},t),{},{users:w(t.users,e),graph:N(t.graph,e)})},R=Object(O.a)(F),I=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"addUsers",value:function(t){R.dispatch({type:T,payload:{users:t}})}},{key:"updateUser",value:function(t,e){var n=R.getState().users,i=e;!Number.isFinite(e)||e<0?i=0:e>n.length-1&&(i=n.length-1);var a=n[i];n[i]=Object(m.a)(Object(m.a)({},a),t),R.dispatch({type:S,payload:{users:n}})}},{key:"replaceUsers",value:function(t){R.dispatch({type:S,payload:{users:t}})}}]),t}();function L(){return R.getState().users}var E=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"validate",value:function(){return this.validateAllIds()}},{key:"validateAllIds",value:function(){var t=L(),e={},n=!0;t.forEach((function(t,i){var a,r=t.id;(null===(a=e[r])||void 0===a?void 0:a.count)?e[r]={count:1,indexes:[i]}:(e[r].indexes.push(i),e[r].count=e[r].indexes.length,n=!1)}));var i=!1,a=t.map((function(t){var n,a=null===(n=e[t.id])||void 0===n?void 0:n.count,r=!a||1===a;return t.isValid!==r?(i=!0,Object(m.a)(Object(m.a)({},t),{},{isValid:r})):t}));return i&&I.replaceUsers(a),n}},{key:"validateUserId",value:function(t){var e,n=L(),i=null===(e=n[t])||void 0===e?void 0:e.id;if(!Number.isFinite(i))return!1;var a=n.every((function(e,n){return i!==e.id||t===n}));return n[t].isValid!==a&&(n[t].isValid=a,I.updateUser(n[t],t)),a}},{key:"validateAllDate",value:function(){var t=this,e=!0;return L().forEach((function(n,i){e=t.validateUserDate(i)&&e})),e}},{key:"validateUserDate",value:function(t){var e,n,i=L()[t],a=!0;return(null===i||void 0===i||null===(e=i.registration)||void 0===e?void 0:e.getTime)&&(null===(n=i.lastActivity)||void 0===n?void 0:n.getTime)||(a=!1),i.lastActivity.getTime()>Date.now()&&(a=!1),i.registration.getTime()>i.lastActivity.getTime()&&(a=!1),i.isValid!==a&&(i.isValid=a,I.updateUser(i,t)),a}}]),t}(),U=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"init",value:function(){return this.safetyLoad()}},{key:"validate",value:function(){return E.validate()}},{key:"trySave",value:function(){var t=Object(l.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.validate()){t.next=2;break}throw new Error("invalid users data");case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"tryLoad",value:function(){return y.load().then((function(t){return function(t){return t.map((function(t){return Object(m.a)(Object(m.a)({},t),{},{registration:new Date(t.registration),lastActivity:new Date(t.lastActivity)})}))}(t)})).then((function(t){return I.replaceUsers(t)}))}},{key:"safetyLoad",value:function(){return this.tryLoad().catch((function(t){return console.error(t)}))}}]),t}();var _=function(t){var e=L();if(Array.isArray(e)&&e.length){var n=e[e.length-1];I.addUsers([Object(m.a)(Object(m.a)({},M()),{},{id:n.id+1})])}else I.addUsers([M()])};function M(){return{id:1,registration:new Date,lastActivity:new Date,isValid:!0}}var B=n(4),V=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"setRetention",value:function(t){R.dispatch({type:A,payload:{retention:t}})}},{key:"replaceHistogram",value:function(t){R.dispatch({type:x,payload:{histogram:t}})}},{key:"pushHistogramBins",value:function(t){var e=R.getState().graph.histogram,n=e.bins.concat(t);R.dispatch({type:x,payload:{histogram:Object(m.a)(Object(m.a)({},e),{},{bins:n})}})}},{key:"replaceSpline",value:function(t){R.dispatch({type:k,payload:{spline:t}})}}]),t}(),Y=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"calcHistogram",value:function(){var t=this.getBinLifeTimes(),e=Math.max.apply(Math,Object(D.a)(t)),n=this.normTo1(t,e);V.replaceHistogram({bins:n,maxBin:e})}},{key:"getBinLifeTimes",value:function(){var t,e=this.getLifeTimes(),n=new Array(e.length).fill(0),i=0,a=Object(B.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value,c=Math.floor(r/this.DAY);n[c]+=1,c>i&&(i=c)}}catch(o){a.e(o)}finally{a.f()}return n.slice(0,i+1)}},{key:"getLifeTimes",value:function(){return L().map((function(t){return t.lastActivity.getTime()-t.registration.getTime()}))}},{key:"normTo1",value:function(t,e){var n=e||Math.max.apply(Math,Object(D.a)(t));return n?t.map((function(t){return t/n})):t}},{key:"getDebugBins",value:function(t,e){for(var n=[],i=0;i<t;i++)n.push(Math.round(Math.random()*e));return n}}]),t}();Y.DAY=864e5;var P=function(){function t(){Object(d.a)(this,t)}return Object(v.a)(t,null,[{key:"calcRetention",value:function(){var t=this.getRollingRetention(7);Number.isFinite(t)&&V.setRetention(t)}},{key:"getRollingRetention",value:function(t){if(t<1)return 1;var e,n=this.floorTime(this.getIntervalTime(t)),i=this.floorTime(Date.now()),a=0,r=0,c=L(),o=Object(B.a)(c);try{for(o.s();!(e=o.n()).done;){var s=e.value,u=this.floorTime(s.registration.getTime());i-u>=n&&r++,this.floorTime(s.lastActivity.getTime())-u>=n&&a++}}catch(l){o.e(l)}finally{o.f()}return r?a/r:NaN}},{key:"getIntervalTime",value:function(t){return t*this.DAY}},{key:"floorTime",value:function(t){return t-t%this.DAY}},{key:"getSimpleRollingRetention",value:function(t){if(t<1)return NaN;var e,n=this.getIntervalTime(t),i=L(),a=0,r=0,c=Date.now(),o=Object(B.a)(i);try{for(o.s();!(e=o.n()).done;){var s=e.value,u=s.registration.getTime();c-u<=n?r++:s.lastActivity.getTime()-u>=n&&a++}}catch(l){o.e(l)}finally{o.f()}return r?a/r:NaN}}]),t}();P.DAY=864e5;var H=function(t){P.calcRetention(),Y.calcHistogram()},z=n(5),G=function(){var t=Object(i.useState)(!1),e=Object(o.a)(t,2),n=e[0],a=e[1];return Object(z.jsxs)("div",{className:"controls",children:[Object(z.jsx)("button",{className:"controls-button_add button",disabled:n,type:"button",onClick:_,children:"Add"}),Object(z.jsx)("button",{className:"controls-button_save button",disabled:n,type:"submit",onClick:function(t){a(!0),U.trySave().then((function(){return U.tryLoad()})).catch((function(t){return console.error(t)})).finally((function(){return a(!1)}))},children:"Save"}),Object(z.jsx)("button",{className:"controls-button_calculate button",disabled:n,type:"button",onClick:H,children:"Calculate"})]})},q=(n(48),n(14)),J=(n(55),function(t){var e=t.height,n=void 0===e?500:e,i=Object(q.b)((function(t){return t.graph.histogram.maxBin||0})),a=Object(q.b)((function(t){return t.graph.histogram.bins}));if(!Array.isArray(a))return Object(z.jsx)("svg",{});var r=n,c=50,o=r-100,s=13*a.length+100;function u(t){return Object(z.jsx)("text",{x:"".concat(13*t+c+5),y:"".concat(r-25),textAnchor:"middle",children:"".concat(t)})}return Object(z.jsx)("svg",{width:"".concat(s),height:"".concat(r),textRendering:"optimizeLegibility",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:Object(z.jsxs)("g",{fill:"#4A9DFF",children:[function(){var t=25,e=i/2,n=r-c-o,a=r-c-o/2,u=r-c;return Object(z.jsxs)("g",{stroke:"rgba(74, 157, 255, .4)",children:[Object(z.jsx)("text",{x:"".concat(t),textAnchor:"middle",y:"".concat(n),children:"".concat(i)}),Object(z.jsx)("line",{x1:"".concat(t),x2:"".concat(s-c),y1:"".concat(n," "),y2:"".concat(n)}),Object(z.jsx)("text",{x:"".concat(t),textAnchor:"middle",y:"".concat(a),children:"".concat(e)}),Object(z.jsx)("line",{x1:"".concat(t),x2:"".concat(s-c),y1:"".concat(a," "),y2:"".concat(a)}),Object(z.jsx)("text",{x:"".concat(t),textAnchor:"middle",y:"".concat(u),children:"0"}),Object(z.jsx)("line",{x1:"".concat(t),x2:"".concat(s-c),y1:"".concat(u," "),y2:"".concat(u)})]})}(),a.map((function(t,e){var n=t*o;return Object(z.jsxs)("g",{children:[Object(z.jsx)("rect",{x:"".concat(13*e+c),y:"".concat(r-n-c),width:"".concat(10),height:"".concat(n)}),!(e%5)&&u(e)]},e)}))]})})}),K=function(){var t=Object(q.b)((function(t){var e;return!!(null===(e=t.graph.histogram.bins)||void 0===e?void 0:e.length)}));return Object(z.jsx)("div",{className:"histogram",children:t&&Object(z.jsx)(J,{})})},Q=(n(56),function(){var t=Object(q.b)((function(t){return t.graph.retention}));return Number.isFinite(t)?Object(z.jsx)("div",{className:"retention",children:"Rolling Retention 7 day: ".concat(t)}):Object(z.jsx)("div",{})}),W=function(){return Object(z.jsxs)("div",{className:"graph",children:[Object(z.jsx)(Q,{}),Object(z.jsx)(K,{})]})};n(57),n(58);function X(t){return(null===t||void 0===t?void 0:t.getFullYear)?"".concat(t.getFullYear(),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getDate().toString().padStart(2,"0")):""}function Z(t){if(!(null===t||void 0===t?void 0:t.split))return new Date;var e=t.trim().split("-").map((function(t){return parseInt(t)||0})),n=new Date;return e.length&&n.setFullYear(e[0],e[1],e[2]),n}function $(t,e){var n=L()[e];n&&I.updateUser(Object(m.a)(Object(m.a)({},n),t),e)}var tt=function(t){var e=t.index,n=t.requireCssClass,i=Object(q.b)((function(t){var n;return null===(n=t.users[e])||void 0===n?void 0:n.isValid})),a=Object(q.b)((function(t){var n;return null===(n=t.users[e])||void 0===n?void 0:n.id})),r=Object(q.b)((function(t){var n;return X(null===(n=t.users[e])||void 0===n?void 0:n.registration)})),c=Object(q.b)((function(t){var n;return X(null===(n=t.users[e])||void 0===n?void 0:n.lastActivity)})),o=n+" user"+(!1===i?" user_invalid":"");return Object(z.jsxs)("tr",{className:o,children:[Object(z.jsx)("td",{className:"user-item user-item_first",children:Object(z.jsx)("input",{value:a,name:"userId",onChange:function(t){$({id:+t.target.value},e)},type:"number",className:"user-item-input user-item-input_clear",size:a.toString().length+1})}),Object(z.jsx)("td",{className:"user-item",children:Object(z.jsx)("input",{value:r,name:"registration",onChange:function(t){$({registration:Z(t.target.value)},e)},type:"date",className:"user-item-input"})}),Object(z.jsx)("td",{className:"user-item user-item_last",children:Object(z.jsx)("input",{value:c,name:"lastActivity",onChange:function(t){$({lastActivity:Z(t.target.value)},e)},type:"date",className:"user-item-input"})})]})},et=function(){var t=Object(q.b)((function(t){return t.users}),(function(t,e){return t.length===e.length}));return Object(z.jsxs)("table",{className:"table",children:[Object(z.jsx)("caption",{className:"table-caption",children:"Users activity"}),Object(z.jsx)("thead",{className:"table-head",children:Object(z.jsxs)("tr",{children:[Object(z.jsx)("th",{className:"table-head-item",scope:"col",children:"UserID"}),Object(z.jsx)("th",{className:"table-head-item",scope:"col",children:"Date Registration"}),Object(z.jsx)("th",{className:"table-head-item",scope:"col",children:"Date Last Activity"})]})}),Object(z.jsx)("tbody",{className:"table-body",children:t.map((function(t,e){return Object(z.jsx)(tt,{requireCssClass:"table-body-item",index:e},"table-".concat(e,"-").concat(t.id))}))})]})},nt=function(){return Object(z.jsxs)("div",{className:"app",children:[Object(z.jsxs)("div",{className:"app-data",children:[Object(z.jsx)(et,{}),Object(z.jsx)(W,{})]}),Object(z.jsx)(G,{})]})},it=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,60)).then((function(e){var n=e.getCLS,i=e.getFID,a=e.getFCP,r=e.getLCP,c=e.getTTFB;n(t),i(t),a(t),r(t),c(t)}))};U.init(),c.a.render(Object(z.jsxs)(a.a.StrictMode,{children:[Object(z.jsx)(q.a,{store:R,children:Object(z.jsx)(nt,{})}),","]}),document.getElementById("root")),it()}},[[59,1,2]]]);
//# sourceMappingURL=main.c23ed63a.chunk.js.map